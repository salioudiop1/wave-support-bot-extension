import{R as l,j as e,s as le,c as je}from"./assets/assistant-Ckp6YHBR.js";var _=typeof globalThis<"u"?globalThis:window,ge=_.process||{env:{NODE_ENV:"production"}},ye=_.global||_;_.process=ge;_.global=ye;const f={Search:n=>e.jsxs("svg",{...n,viewBox:"0 0 24 24",width:"16",height:"16",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"11",cy:"11",r:"7"}),e.jsx("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})]}),Reset:n=>e.jsxs("svg",{...n,viewBox:"0 0 24 24",width:"16",height:"16",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("polyline",{points:"1 4 1 10 7 10"}),e.jsx("path",{d:"M3.51 15a9 9 0 1 0 2.13-9.36L1 10"})]}),Restart:n=>e.jsxs("svg",{...n,viewBox:"0 0 24 24",width:"16",height:"16",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("polyline",{points:"23 4 23 10 17 10"}),e.jsx("path",{d:"M20.49 15a9 9 0 1 1-2.13-9.36L23 10"})]}),Copy:n=>e.jsxs("svg",{...n,viewBox:"0 0 24 24",width:"16",height:"16",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("rect",{x:"9",y:"9",width:"13",height:"13",rx:"2",ry:"2"}),e.jsx("path",{d:"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"})]}),Check:n=>e.jsx("svg",{...n,viewBox:"0 0 24 24",width:"16",height:"16",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("polyline",{points:"20 6 9 17 4 12"})}),File:n=>e.jsxs("svg",{...n,viewBox:"0 0 24 24",width:"16",height:"16",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),e.jsx("polyline",{points:"14 2 14 8 20 8"})]}),ChevronRight:n=>e.jsx("svg",{...n,viewBox:"0 0 24 24",width:"16",height:"16",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("polyline",{points:"9 18 15 12 9 6"})}),ArrowLeft:n=>e.jsxs("svg",{...n,viewBox:"0 0 24 24",width:"16",height:"16",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"19",y1:"12",x2:"5",y2:"12"}),e.jsx("polyline",{points:"12 19 5 12 12 5"})]}),Home:n=>e.jsxs("svg",{...n,viewBox:"0 0 24 24",width:"16",height:"16",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M3 11l9-7 9 7"}),e.jsx("path",{d:"M9 22V12h6v10"})]}),Close:n=>e.jsxs("svg",{...n,viewBox:"0 0 24 24",width:"16",height:"16",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]}),Maximize:n=>e.jsxs("svg",{...n,viewBox:"0 0 24 24",width:"16",height:"16",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("polyline",{points:"15 3 21 3 21 9"}),e.jsx("line",{x1:"14",y1:"10",x2:"21",y2:"3"}),e.jsx("polyline",{points:"9 21 3 21 3 15"}),e.jsx("line",{x1:"10",y1:"14",x2:"3",y2:"21"})]}),Minimize:n=>e.jsxs("svg",{...n,viewBox:"0 0 24 24",width:"16",height:"16",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("polyline",{points:"9 3 3 3 3 9"}),e.jsx("line",{x1:"10",y1:"10",x2:"3",y2:"3"}),e.jsx("polyline",{points:"15 21 21 21 21 15"}),e.jsx("line",{x1:"14",y1:"14",x2:"21",y2:"21"})]}),Plus:n=>e.jsxs("svg",{...n,viewBox:"0 0 24 24",width:"14",height:"14",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]})};async function ve(n){try{return await navigator.clipboard.writeText(n),!0}catch{try{const a=document.createElement("textarea");return a.value=n,a.style.position="fixed",a.style.left="-9999px",document.body.appendChild(a),a.select(),document.execCommand("copy"),document.body.removeChild(a),!0}catch{return!1}}}const j=(n="")=>n.toString().normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase();function ce({text:n="",query:a=""}){const c=(a||"").trim();if(!c||c.length<3)return e.jsx(e.Fragment,{children:n});const u=C=>C.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),N=new RegExp(`(${u(c)})`,"ig"),y=String(n).replace(N,"<mark>$1</mark>");return e.jsx("span",{dangerouslySetInnerHTML:{__html:y}})}function ke({def:n}){const[a,c]=l.useState(!1),u=Object.keys(n?.langs||{}),N=u.includes("fr")?"fr":u[0]||"fr",[y,C]=l.useState(N),[h,S]=l.useState(n?.langs?.[N]||""),T=l.useRef(null);l.useEffect(()=>{S(n?.langs?.[y]||"")},[y,n]);const g=280;l.useEffect(()=>{const d=T.current;if(!d)return;d.style.height="auto";const v=Math.min(d.scrollHeight,g);d.style.height=v+"px",d.style.overflowY=d.scrollHeight>g?"auto":"hidden"},[h]);const A=async()=>{await ve(h)&&(c(!0),setTimeout(()=>c(!1),1200))},w=()=>S(n?.langs?.[y]||"");return e.jsxs("div",{className:"tpl-shell",children:[e.jsxs("div",{className:"tpl-top",children:[e.jsx("div",{className:"tpl-meta",children:e.jsx("div",{className:"tpl-title",children:n?.label||"Message"})}),e.jsx("div",{className:"lang-pills",children:u.map(d=>e.jsx("button",{className:`lang-pill ${d===y?"active":""}`,onClick:()=>C(d),title:d.toUpperCase(),children:d.toUpperCase()},d))})]}),e.jsx("textarea",{ref:T,className:"tpl-code",value:h,onChange:d=>S(d.target.value)}),e.jsxs("div",{className:"tpl-bottom",children:[e.jsx("button",{className:"tpl-btn",onClick:w,title:"Réinitialiser",children:e.jsx(f.Reset,{})}),e.jsx("button",{className:`tpl-btn ${a?"success":""}`,onClick:A,title:a?"Copié":"Copier",children:a?e.jsx(f.Check,{style:{marginRight:8}}):e.jsx(f.Copy,{})})]})]})}function q({role:n="asst",children:a,wide:c=!1}){return e.jsx("div",{className:`chat-turn ${n==="user"?"user":"asst"}`,children:e.jsx("div",{className:`chat-msg ${c?"wide":""}`,style:c?{maxWidth:"80%",width:"80%",flexBasis:"80%"}:void 0,children:a})})}const de="ProcessAssistantTabs.v1",J=(n={})=>({id:crypto?.randomUUID?.()||String(Date.now()+Math.random()),title:"Accueil",phase:"idle",input:"",selectedSlug:"",messages:[],scrollTop:0,ts:Date.now(),...n});function we({open:n,onClose:a,processes:c,templatesBySlug:u,__flowsUrl:N,__logoUrl:y="/logo.png",__headerless:C=!1}){const h=!!C,[S,T]=l.useState(!1),[g,A]=l.useState(!1),[w,d]=l.useState(""),v=l.useRef(null),[k,p]=l.useState([J()]),[m,F]=l.useState(k[0].id),x=k.find(t=>t.id===m)||k[0],R=l.useCallback(t=>{p(i=>i.map(s=>s.id===m?{...s,...t,ts:Date.now()}:s))},[m]),E=l.useCallback(t=>{t?.length&&p(i=>i.map(s=>s.id===m?{...s,messages:[...s.messages||[],...t],ts:Date.now()}:s))},[m]),X=l.useCallback((t=[],i="")=>(t||[]).map(s=>s.type==="template"?{type:"template",templateId:s.templateDef?.id,slug:i}:s.type==="decision"?{type:"decision",options:(s.options||[]).map(r=>({label:r.label,next:r.next}))}:s.type==="assistant"||s.type==="user"?{type:s.type,text:s.text}:s),[]),z=l.useCallback((t,i)=>{const s=(u?.[t]||[]).find(o=>o.id===i);if(s)return s;const r=(u?.common||[]).find(o=>o.id===i);if(r)return r;for(const o of Object.keys(u||{})){const b=(u[o]||[]).find(I=>I.id===i);if(b)return b}return null},[u]),G=l.useCallback((t=[])=>(t||[]).map(i=>{if(i.type==="template"){const s=z(i.slug,i.templateId);return s?{type:"template",templateDef:s}:{type:"assistant",text:"Template indisponible."}}return i}),[z]),D=l.useCallback((t={})=>{try{const s={tabs:k.map(r=>r.id===m?{...r,scrollTop:v.current?.scrollTop??r.scrollTop}:r).map(r=>({...r,messages:X(r.messages,r.selectedSlug)})),activeId:m,...t};localStorage.setItem(de,JSON.stringify(s))}catch{}},[k,m,X]),Q=l.useCallback(()=>{try{const t=localStorage.getItem(de);if(!t)return null;const i=JSON.parse(t);if(!i?.tabs?.length)return null;const s=i.tabs.map(r=>({...r,messages:G(r.messages||[])}));return{tabs:s,activeId:i.activeId||s[0].id}}catch{return null}},[G]);l.useLayoutEffect(()=>{if(!(h?n!==!1:n))return;const i=Q();i&&(p(i.tabs),F(i.activeId),requestAnimationFrame(()=>v.current?.scrollTo?.({top:i.tabs.find(s=>s.id===i.activeId)?.scrollTop||0,behavior:"auto"})))},[n,h,Q]),l.useEffect(()=>{(h?n!==!1:n)&&D()},[k,m,n,h,D]);const ue=1,[L,Z]=l.useState(null),[B,ee]=l.useState(!1),[te,se]=l.useState(""),O=async()=>{try{ee(!0),se("");const i=await fetch(`${N||"/processes/flows.json"}?v=${ue}`,{cache:"no-store"});if(!i.ok)throw new Error(`HTTP ${i.status}`);const s=await i.json();Z(s?.flows||{})}catch(t){console.error(t),Z({}),se("load-error")}finally{ee(!1)}};l.useEffect(()=>{(h?n!==!1:n)&&L===null&&!B&&O()},[n,h,L,B]);const M=l.useMemo(()=>{const t=j((x?.input||"").trim());return t.length<3?[]:(Array.isArray(c)?c:[]).map(s=>({...s,hay:j([s.title,s.summary,s.slug,(s.tags||[]).join(" ")].join(" "))})).filter(s=>s.hay.includes(t)).slice(0,6)},[x?.input,c]),[W,H]=l.useState(-1),ne=l.useCallback(()=>{const t=j((x?.input||"").trim());if(!t)return null;const i=Array.isArray(c)?c:[];let s=i.find(r=>j(r.slug)===t)||i.find(r=>j(r.title)===t);return s||(s=i.find(r=>j(r.title).startsWith(t))||i.find(r=>(r.tags||[]).some(o=>j(o).startsWith(t))),s)?s:(s=i.find(r=>j([r.title,r.summary,r.slug,(r.tags||[]).join(" ")].join(" ")).includes(t)),s||null)},[x?.input,c]),K=(t,i)=>{if(!t)return;const s=[];if(t.text&&s.push({type:"assistant",text:t.text}),t.templateId&&s.push({type:"template",templateDef:z(i,t.templateId)}),t.type!=="end"){if(t.options?.length){s.push({type:"decision",options:t.options}),E(s);return}else if(t.next){E(s);const r=L?.[i]?.nodes?.[t.next];r&&setTimeout(()=>K(r,i),0);return}}E(s)},ie=(t,{initialUserHeader:i=!0}={})=>{const r=(Array.isArray(c)?c:[]).find(b=>b.slug===t)?.title||t;if(R({selectedSlug:t,phase:"run",title:r,messages:i?[{type:"user",text:r}]:[],input:""}),B){E([{type:"assistant",text:"Chargement des flows…"}]);return}if(!L||!L[t]){E([{type:"assistant",text:"Aucun flow défini pour ce process pour le moment."}]);return}const o=L[t].nodes?.[L[t].start];if(!o){E([{type:"assistant",text:"Flow invalide : nœud de départ introuvable."}]);return}K(o,t),setTimeout(()=>v.current?.scrollTo?.({top:999999,behavior:"smooth"}),50)},U=t=>{const i=typeof t=="string"?t:t?.slug;i&&ie(i)},he=t=>{if(!t?.next)return;p(r=>r.map(o=>{if(o.id!==m)return o;const b=[...o.messages||[]];let I=-1;for(let P=b.length-1;P>=0;P--)if(b[P].type==="decision"){I=P;break}return I>=0?b[I]={type:"user",text:t.label}:b.push({type:"user",text:t.label}),{...o,messages:b,ts:Date.now()}}));const i=k.find(r=>r.id===m)?.selectedSlug||x?.selectedSlug,s=i?L?.[i]?.nodes?.[t.next]:null;s&&setTimeout(()=>{K(s,i),setTimeout(()=>v.current?.scrollTo?.({top:999999,behavior:"smooth"}),30)},0)},$=()=>{R({phase:"idle",selectedSlug:"",messages:[],input:"",title:"Accueil"}),H(-1),d("")},pe=()=>{const t=x?.selectedSlug;!t||B||ie(t)};l.useEffect(()=>{if(!(h?n!==!1:n))return;const i=s=>{const r=M.length>0;if(r&&(s.key==="ArrowDown"&&(s.preventDefault(),H(o=>Math.min(o+1,M.length-1))),s.key==="ArrowUp"&&(s.preventDefault(),H(o=>Math.max(o-1,0))),s.key==="Enter")){s.preventDefault();const o=W>=0?M[W]:M[0];if(o)return U(o)}if(s.key==="Enter"&&!r&&(x?.input||"").trim()){const o=ne();if(o)return U(o);setTimeout(()=>d(""),1400)}s.key==="Escape"&&V(),s.altKey&&(s.key==="h"||s.key==="H")&&(s.preventDefault(),$()),s.altKey&&(s.key==="m"||s.key==="M")&&(s.preventDefault(),A(o=>!o))};return window.addEventListener("keydown",i),()=>window.removeEventListener("keydown",i)},[n,h,M.length,W,x?.input,ne]),l.useEffect(()=>{if(!(h?n!==!1:n))return;let i=null;const s=()=>{i&&cancelAnimationFrame(i),i=requestAnimationFrame(()=>{R({scrollTop:v.current?.scrollTop??0})})},r=v.current;return r?.addEventListener?.("scroll",s,{passive:!0}),()=>r?.removeEventListener?.("scroll",s)},[n,h,R]);const me=()=>{const t=J();p(i=>[...i,t]),F(t.id)},xe=t=>{p(i=>{const s=i.findIndex(o=>o.id===t);if(s===-1)return i;const r=i.filter(o=>o.id!==t);if(!r.length){const o=J();return F(o.id),[o]}return t===m&&F(r[Math.max(0,s-1)].id),r})},fe=e.jsxs("div",{className:"assistant-hero",children:[e.jsxs("div",{className:"hero-circle clip",children:[!S&&y&&e.jsx("img",{src:y,alt:"Wave",className:"hero-logo-clip",loading:"lazy",onError:()=>T(!0)}),(S||!y)&&e.jsx("div",{className:"hero-fallback",children:"W"})]}),e.jsx("div",{className:"hero-title",children:"Ask anything about processes"}),e.jsx("div",{className:"hero-sub",children:"Tape un mot-clé pour trouver le bon process"}),e.jsx("div",{className:"chips",children:["Reset PIN","Déplafonnement","Dormancy Block"].map((t,i)=>{const s=Array.isArray(c)?c:[],r=s.find(o=>j(o.title)===j(t))||s.find(o=>j(o.title).includes(j(t)))||null;return e.jsx("button",{className:"chip",onClick:()=>r?U(r):R({input:t}),title:t,children:t},i)})}),te&&e.jsxs("div",{className:"note-card warning mt-3",children:["Impossible de charger ",e.jsx("code",{children:"/processes/flows.json"}),".",e.jsx("button",{className:"btn btn-sm btn-outline-secondary ms-2",onClick:O,children:"Réessayer"})]})]}),re=e.jsxs("div",{className:"assistant-body",ref:v,style:{flex:1,minHeight:0,overflow:"auto"},children:[x?.phase==="idle"&&fe,x?.phase==="run"&&e.jsx("div",{className:"chat-area",children:(x?.messages||[]).map((t,i)=>t.type==="assistant"?e.jsx(q,{role:"asst",children:e.jsx("div",{className:"msg-text",children:t.text})},i):t.type==="template"?e.jsx(q,{role:"asst",wide:!0,children:e.jsx(ke,{def:t.templateDef})},i):t.type==="decision"?e.jsx(q,{role:"user",children:e.jsx("div",{className:"qr-panel",children:t.options.map((s,r)=>e.jsx("button",{className:"qr-btn",onClick:()=>he(s),children:s.label},r))})},i):t.type==="user"?e.jsx(q,{role:"user",children:e.jsx("div",{className:"msg-text user",children:t.text})},i):null)})]}),ae=e.jsxs("div",{className:"assistant-input-wrap ai",children:[w&&e.jsx("div",{className:"ai-toast",children:w}),e.jsxs("div",{className:"ai-input",children:[e.jsx("span",{className:"ai-input-icon","aria-hidden":"true",children:e.jsx(f.Search,{})}),e.jsx("input",{className:"ai-input-field",placeholder:"Ask me anything",value:x?.input||"",onChange:t=>{R({input:t.target.value}),H(-1)}}),x?.phase==="run"&&e.jsx("button",{className:"ai-input-restart",onClick:pe,"aria-label":"Recommencer le flow",title:"Recommencer le flow",disabled:!x?.selectedSlug||B,children:e.jsx(f.Restart,{})}),e.jsx("button",{className:"ai-input-home",onClick:()=>{$()},"aria-label":"Accueil",title:"Accueil (Alt+H)",children:e.jsx(f.Home,{})})]}),M.length>0&&e.jsx("div",{className:"ai-suggest",children:M.map((t,i)=>e.jsxs("button",{className:`ai-suggest-item ${i===W?"active":""}`,onClick:()=>U(t),title:t.title,children:[e.jsx("div",{className:"ai-suggest-icon",children:e.jsx(f.File,{})}),e.jsxs("div",{className:"ai-suggest-texts",children:[e.jsx("div",{className:"ai-suggest-title",children:e.jsx(ce,{text:t.title,query:x?.input||""})}),t.summary&&e.jsx("div",{className:"ai-suggest-sub",children:e.jsx(ce,{text:t.summary,query:x?.input||""})}),Array.isArray(t.tags)&&t.tags.length>0&&e.jsx("div",{className:"ai-suggest-tags",children:t.tags.slice(0,3).map((s,r)=>e.jsx("span",{className:"ai-tag",children:s},r))})]}),e.jsx("span",{className:"ai-suggest-caret",children:e.jsx(f.ChevronRight,{})})]},t.slug))})]}),oe=e.jsxs("div",{className:"assist-tabs",children:[e.jsx("div",{className:"assist-tabs-scroll",children:k.map(t=>e.jsxs("button",{className:`assist-tab ${t.id===m?"active":""}`,onClick:()=>F(t.id),title:t.title,children:[e.jsx("span",{className:"assist-tab-label",children:t.title||"Session"}),e.jsx("span",{className:"assist-tab-close",onClick:i=>{i.stopPropagation(),xe(t.id)},"aria-label":"Fermer l'onglet",title:"Fermer l'onglet",children:e.jsx(f.Close,{})})]},t.id))}),e.jsx("button",{className:"assist-tab-add",onClick:me,title:"Nouvel onglet",children:e.jsx(f.Plus,{})})]}),V=l.useCallback(()=>{D(),a?.()},[a,D]);return h?e.jsxs("div",{className:"assistant-root",style:{display:"flex",flexDirection:"column",height:"100%",minHeight:0},children:[oe,re,ae]}):n?e.jsx("div",{className:"modal-overlay modal-overlay-glass",role:"dialog","aria-modal":"true",onClick:V,children:e.jsxs("div",{className:`modal-card qto-modal modal-elevated assistant-modal ${g?"is-max":""}`,onClick:t=>t.stopPropagation(),style:g?{width:"min(98vw, 1024px)",height:"min(95vh, 800px)",display:"flex",flexDirection:"column"}:{width:"min(96vw, 680px)",height:"min(88vh, 620px)",display:"flex",flexDirection:"column"},children:[e.jsxs("div",{className:"assistant-header",children:[e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[x?.phase==="run"&&e.jsx("button",{className:"btn btn-ghost px-2 assistant-back",onClick:$,"aria-label":"Retour",title:"Réinitialiser la session",children:e.jsx(f.ArrowLeft,{})}),e.jsx("span",{className:"fw-700",children:"Wave Digital AI Assist"}),B&&e.jsx("span",{className:"small text-muted ms-2",children:"· chargement…"}),te&&e.jsx("button",{className:"btn btn-link btn-sm text-danger ms-2 p-0",onClick:O,children:"Réessayer"})]}),e.jsxs("div",{className:"d-flex align-items-center gap-1",children:[e.jsx("button",{className:"btn btn-ghost px-2 assistant-home",onClick:t=>{t.stopPropagation(),$()},"aria-label":"Accueil",title:"Accueil (Alt+H)",children:e.jsx(f.Home,{})}),e.jsx("button",{className:"btn btn-ghost px-2 assistant-maximize",onClick:t=>{t.stopPropagation(),A(i=>!i)},"aria-label":g?"Réduire":"Agrandir",title:(g?"Réduire":"Agrandir")+" (Alt+M)",children:g?e.jsx(f.Minimize,{}):e.jsx(f.Maximize,{})}),e.jsx("button",{className:"btn btn-ghost rounded-circle assistant-close",onClick:t=>{t.stopPropagation(),V()},"aria-label":"Fermer",title:"Fermer",children:e.jsx(f.Close,{})})]})]}),oe,re,ae]})}):null}async function Y(n){if(!n)return null;try{const a=await fetch(n,{cache:"no-store"});if(!a.ok)throw new Error(`HTTP ${a.status}`);return await a.json()}catch(a){return console.error("[Assist] fetchJson failed:",n,a),null}}async function be(n){const a=await Y(n);return a?a&&(a.templatesBySlug||a.processes)?{processes:Array.isArray(a.processes)?a.processes:[],templatesBySlug:a.templatesBySlug||{}}:a&&!Array.isArray(a)?{processes:[],templatesBySlug:a}:Array.isArray(a)?{processes:a,templatesBySlug:{}}:{processes:[],templatesBySlug:{}}:{processes:[],templatesBySlug:{}}}async function Ne(n){const a=await Y(n);return a?Array.isArray(a)?a:Array.isArray(a.processes)?a.processes:[]:[]}async function Ce(n){const a=await Y(n);if(!a||!a.flows)return[];try{return Object.entries(a.flows).map(([c,u])=>({slug:c,title:u?.title||c,summary:u?.summary||"",tags:u?.tags||[]}))}catch{return[]}}window.WaveAssist={async mount(n,a={}){const{open:c=!0,flowsUrl:u,templatesUrl:N,processesUrl:y,__logoUrl:C}=a,{processes:h,templatesBySlug:S}=await be(N),T=await Ne(y);let g=T.length?T:h;if((!g||g.length===0)&&u){const p=await Ce(u);p.length&&(g=p)}const A=n.getRootNode&&n.getRootNode(),w=A&&A.host?A:null;if(w&&!w.__ASSIST_CSS__){const p=document.createElement("style");p.textContent=le,w.appendChild(p),w.__ASSIST_CSS__=!0}else if(!w){const p="__assist_css__";if(!document.getElementById(p)){const m=document.createElement("style");m.id=p,m.textContent=le,document.head.appendChild(m)}}const d=C&&String(C)||(typeof chrome<"u"&&chrome.runtime?.getURL?chrome.runtime.getURL("assets/logo.png"):new URL("assets/logo.png",import.meta.url).href),v=p=>e.jsx(we,{...p,__flowsUrl:u,__logoUrl:d,__headerless:!0}),k=je.createRoot(n);return k.render(e.jsx(v,{open:c,processes:g,templatesBySlug:S})),k}};
