import{r as i,j as e,s as $,c as D}from"./assets/assistant-Ckp6YHBR.js";var N=typeof globalThis<"u"?globalThis:window,U=N.process||{env:{NODE_ENV:"production"}},F=N.global||N;N.process=U;N.global=F;const w=(r="")=>r.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().trim(),k={search:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24","aria-hidden":"true",children:[e.jsx("circle",{cx:"11",cy:"11",r:"7",fill:"none",stroke:"currentColor",strokeWidth:"2"}),e.jsx("path",{d:"M20 20l-3.5-3.5",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]}),check:e.jsx("svg",{viewBox:"0 0 24 24",width:"16",height:"16",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",focusable:"false",children:e.jsx("polyline",{points:"20 6 9 17 4 12"})}),copy:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24","aria-hidden":"true",children:[e.jsx("rect",{x:"9",y:"9",width:"10",height:"10",rx:"2",fill:"none",stroke:"currentColor",strokeWidth:"2"}),e.jsx("rect",{x:"5",y:"5",width:"10",height:"10",rx:"2",fill:"none",stroke:"currentColor",strokeWidth:"2",opacity:"0.6"})]}),reset:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24","aria-hidden":"true",children:[e.jsx("path",{d:"M3 12a9 9 0 1 0 3-6.7",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),e.jsx("path",{d:"M3 5v4h4",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]})};async function H(r){try{return await navigator.clipboard.writeText(r),!0}catch{try{const t=document.createElement("textarea");return t.value=r,t.style.position="fixed",t.style.left="-9999px",document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t),!0}catch{return!1}}}function O({item:r,copiedId:t,setCopiedId:o}){const c=Object.keys(r?.langs||{}),x=c.includes("fr")?"fr":c[0]||"fr",[l,m]=i.useState(x),[d,g]=i.useState(r?.langs?.[x]||""),f=r?.id||`${r?.label||"tpl"}:${x}`;i.useEffect(()=>{const n=c.includes("fr")?"fr":c[0]||"fr";m(n),g(r?.langs?.[n]||"")},[r?.id]),i.useEffect(()=>{g(r?.langs?.[l]||"")},[l]);const p=async()=>{await H(d)&&(o(f),setTimeout(()=>o(""),1200))},y=()=>g(r?.langs?.[l]||"");return e.jsxs("div",{className:"tpl-card",children:[e.jsxs("div",{className:"tpl-card-head",children:[e.jsx("h4",{className:"tpl-card-title",children:r?.label||r?.id||"Template"}),e.jsx("div",{className:"tpl-lang-pills","aria-label":"Langues",children:c.map(n=>e.jsx("button",{className:`tpl-lang-pill ${n===l?"active":""}`,onClick:()=>m(n),title:n.toUpperCase(),type:"button",children:n.toUpperCase()},n))})]}),e.jsx("div",{className:"tpl-card-body",children:e.jsx("div",{className:"tpl-editor",children:e.jsx("textarea",{className:"tpl-editor-textarea",value:d,onChange:n=>g(n.target.value),spellCheck:"true"})})}),e.jsxs("div",{className:"tpl-card-foot",children:[e.jsx("button",{className:"tpl-reset-btn",onClick:y,title:"Réinitialiser","aria-label":"Réinitialiser",type:"button",children:k.reset}),e.jsx("button",{className:"btn-copy btn-copy-right",onClick:p,title:"Copier","aria-label":"Copier",type:"button",children:t===f?k.check:k.copy})]})]})}function z({open:r,onClose:t,templatesBySlug:o,processes:c,embedded:x=!0}){const[l,m]=i.useState(""),[d,g]=i.useState(""),[f,p]=i.useState(""),y=i.useRef(null),n=(s="")=>s.replace(/[-_]+/g," ").replace(/\b\w/g,a=>a.toUpperCase()),{stdList:h,procList:j,allList:S}=i.useMemo(()=>{const a=(Array.isArray(c)?c:[]).map(u=>({slug:u.slug,title:u.title})),b=Object.keys(o||{}),W=new Set(a.map(u=>u.slug)),I=b.filter(u=>!W.has(u)).map(u=>({slug:u,title:n(u)})),L=u=>u.map(v=>({...v,count:Array.isArray(o?.[v.slug])?o[v.slug].length:0})).sort((v,P)=>v.title.localeCompare(P.title)),E=L(I),T=L(a),M=[...E,...T];return{stdList:E,procList:T,allList:M}},[c,o]),A=i.useMemo(()=>{const s=w(d);return s?h.filter(a=>w(a.title).includes(s)):h},[h,d]),B=i.useMemo(()=>{const s=w(d);return s?j.filter(a=>w(a.title).includes(s)):j},[j,d]),_=S.find(s=>s.slug===l)||null,C=Array.isArray(o?.[l])?o[l]:[];return i.useEffect(()=>{if(!r)return;const s=a=>{a.key==="Escape"&&t?.()};if(window.addEventListener("keydown",s),!l&&S.length){const a=h.find(b=>b.count>0)||j.find(b=>b.count>0)||h[0]||j[0];a&&m(a.slug)}return()=>window.removeEventListener("keydown",s)},[r,t,l,S,h,j]),i.useEffect(()=>{p(""),y.current?.scrollTo?.({top:0,behavior:"smooth"})},[l]),r&&x?e.jsx("div",{className:"tpl-panel-root",style:{display:"flex",flexDirection:"column",height:"100%",minHeight:0},children:e.jsxs("div",{className:"tpl-modal-body",style:{flex:1,minHeight:0},children:[e.jsxs("aside",{className:"tpl-sidebar","aria-label":"Catégories",children:[e.jsxs("div",{className:"searchbar mb-2",style:{overflow:"hidden"},children:[e.jsx("input",{value:d,onChange:s=>g(s.target.value),className:"searchbar-input",placeholder:"Rechercher une catégorie…","aria-label":"Rechercher une catégorie"}),e.jsx("span",{className:"searchbar-icon","aria-hidden":"true",children:k.search})]}),A.length>0&&e.jsxs("div",{className:"tpl-sidebar-section",children:[e.jsx("div",{className:"tpl-sidebar-label",children:"Standards"}),e.jsx("ul",{className:"tpl-proc-list",children:A.map(s=>e.jsx("li",{children:e.jsxs("button",{className:`tpl-proc-btn ${s.slug===l?"active":""}`,onClick:()=>m(s.slug),"aria-pressed":s.slug===l,title:s.title,children:[e.jsx("span",{className:"proc-title",children:s.title}),e.jsx("span",{className:`proc-badge ${s.count>0?"":"empty"}`,children:s.count})]})},`std:${s.slug}`))})]}),e.jsxs("div",{className:"tpl-sidebar-section",children:[e.jsx("div",{className:"tpl-sidebar-label",children:"Process"}),e.jsx("ul",{className:"tpl-proc-list",children:B.map(s=>e.jsx("li",{children:e.jsxs("button",{className:`tpl-proc-btn ${s.slug===l?"active":""}`,onClick:()=>m(s.slug),"aria-pressed":s.slug===l,title:s.title,children:[e.jsx("span",{className:"proc-title",children:s.title}),e.jsx("span",{className:`proc-badge ${s.count>0?"":"empty"}`,children:s.count})]})},`proc:${s.slug}`))})]})]}),e.jsxs("section",{className:"tpl-main",children:[e.jsxs("div",{className:"tpl-results small text-muted",children:[Array.isArray(C)?C.length:0," résultat(s)"," ",_?e.jsxs(e.Fragment,{children:["dans « ",e.jsx("strong",{children:_.title})," »"]}):null]}),e.jsxs("div",{className:"tpl-grid",ref:y,children:[C.map((s,a)=>e.jsx(O,{item:s,copiedId:f,setCopiedId:p},`${l}:${s.id||a}`)),C.length===0&&e.jsx("div",{className:"note-card",children:"Aucun template n’est défini pour cet onglet."})]},l)]})]})}):null}async function R(r){if(!r)return null;try{const t=await fetch(r,{cache:"no-store"});if(!t.ok)throw new Error(`HTTP ${t.status}`);return await t.json()}catch(t){return console.error("[TemplatesAdapter] fetchJson failed:",r,t),null}}async function J(r){const t=await R(r);return t?t&&(t.templatesBySlug||t.processes)?{processes:Array.isArray(t.processes)?t.processes:[],templatesBySlug:t.templatesBySlug||{}}:t&&!Array.isArray(t)?{processes:[],templatesBySlug:t}:Array.isArray(t)?{processes:t,templatesBySlug:{}}:{processes:[],templatesBySlug:{}}:{processes:[],templatesBySlug:{}}}async function V(r){const t=await R(r);return t?Array.isArray(t)?t:Array.isArray(t.processes)?t.processes:[]:[]}window.WaveTemplates={async mount(r,t={}){const{open:o=!0,templatesUrl:c,processesUrl:x}=t,{processes:l,templatesBySlug:m}=await J(c),d=await V(x),g=d.length?d:l,f=r.getRootNode&&r.getRootNode(),p=f&&f.host?f:null;if(p&&!p.__ASSIST_CSS__){const n=document.createElement("style");n.textContent=$,p.appendChild(n),p.__ASSIST_CSS__=!0}else if(!p){const n="__assist_css__";if(!document.getElementById(n)){const h=document.createElement("style");h.id=n,h.textContent=$,document.head.appendChild(h)}}const y=D.createRoot(r);return y.render(e.jsx(z,{open:o,onClose:()=>{},templatesBySlug:m,processes:g,embedded:!0})),y}};
